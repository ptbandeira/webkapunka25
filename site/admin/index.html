<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>Content Manager</title>
  </head>
  <body>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
    <script>
      CMS.registerPreviewStyle("/css/bootstrap.min.css");
      CMS.registerPreviewStyle("/style.css?v=footer-fix1");

      // About preview
      var AboutPreview = createClass({
        render: function () {
          var e = this.props.entry, t = e.getIn(["data","title"])||"Our story", b = e.getIn(["data","body"])||"", img = e.getIn(["data","image"]);
          return h("section",{className:"padding-xlarge"},[
            h("div",{className:"container"},[
              h("span",{className:"title-accent fs-6 text-uppercase"},"About Kapunka"),
              h("h3",{className:"py-3"},t),
              h("p",{},b),
              img ? h("img",{src:img, alt:t, style:{maxWidth:"100%",marginTop:"1rem"}}): null
            ])
          ]);
        }
      });
      CMS.registerPreviewTemplate("about", AboutPreview);

      // FAQs preview
      var FaqsPreview = createClass({
        render: function () {
          var items = this.props.entry.getIn(["data","items"]) || [];
          return h("div",{className:"accordion accordion-flush"}, items.map(function(it,i){
            return h("div",{className:"accordion-item",key:i},[
              h("h4",{className:"accordion-header"},h("button",{className:"accordion-button collapsed",type:"button"}, it.get("q")||"Question")),
              h("div",{className:"accordion-body"}, h("p",{}, it.get("a")||"Answer"))
            ]);
          }));
        }
      });
      CMS.registerPreviewTemplate("faqs", FaqsPreview);

      // Products preview
      var ProductsPreview = createClass({
        render: function () {
          var items = this.props.entry.getIn(["data","items"]) || [];
          return h("div",{className:"row"}, items.map(function(p,i){
            return h("div",{className:"col-md-4 mb-4",key:i},[
              h("div",{className:"product-card text-center"},[
                h("img",{src:p.get("image")||"", alt:p.get("name")||"", style:{maxWidth:"100%"} }),
                h("h5",{}, p.get("name")||"Product"),
                h("div",{className:"price"}, p.get("price")||"")
              ])
            ]);
          }));
        }
      });
      CMS.registerPreviewTemplate("products", ProductsPreview);

      // Identity login redirect
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", function(user) {
          if (!user) {
            window.netlifyIdentity.on("login", function() {
              document.location.href = "/admin/";
            });
          }
        });
      }
    </script>
  </body>
</html>
